Author: Philip Martin <philip.martin@wandisco.com>
Subject: Reject operations on prop if the resource is an activity

Subversion's mod_dav_svn Apache HTTPD server module will crash when
a PROPFIND request is made against activity URLs. The patch consists
in rejecting operations on getcontentlength and getcontenttype
properties if the resource is an activity.

Origin: upstream, commit:r1453780
Bug-CVE: http://subversion.apache.org/security/CVE-2013-1849-advisory.txt
Bug-Debian: http://bugs.debian.org/704940
Last-Update: 2013-04-16
Applied-Upstream: commit:r1453780

Index: subversion/mod_dav_svn/liveprops.c
===================================================================
--- a/subversion/mod_dav_svn/liveprops.c	(revision 1458455)
+++ b/subversion/mod_dav_svn/liveprops.c	(working copy)
@@ -410,7 +410,8 @@ insert_prop_internal(const dav_resource *resource,
         svn_filesize_t len = 0;
 
         /* our property, but not defined on collection resources */
-        if (resource->collection || resource->baselined)
+        if (resource->type == DAV_RESOURCE_TYPE_ACTIVITY
+            || resource->collection || resource->baselined)
           return DAV_PROP_INSERT_NOTSUPP;
 
         serr = svn_fs_file_length(&len, resource->info->root.root,
@@ -434,7 +435,9 @@ insert_prop_internal(const dav_resource *resource,
         svn_string_t *pval;
         const char *mime_type = NULL;
 
-        if (resource->baselined && resource->type == DAV_RESOURCE_TYPE_VERSION)
+        if (resource->type == DAV_RESOURCE_TYPE_ACTIVITY
+            || (resource->baselined
+                && resource->type == DAV_RESOURCE_TYPE_VERSION))
           return DAV_PROP_INSERT_NOTSUPP;
 
         if (resource->type == DAV_RESOURCE_TYPE_PRIVATE
